/* New model bookings */CREATE SCHEMA IF NOT EXISTS bookings; /* New table dim_calendar */CREATE TABLE dwh.bookings.dim_calendar(  date_id integer NOT NULL,  src_date date,  ansi_date char(10),  day_no smallint,  week_no smallint,  month_no smallint,  year_no smallint,  weekday smallint);ALTER TABLE dwh.bookings.dim_calendar ADD CONSTRAINT pk_dim_calendar  PRIMARY KEY (date_id); CREATE EXTENSION if not exists postgres_fdw;create server localsrvforeign data wrapper postgres_fdwoptions(host 'localhost', dbname 'demo', port '5432');create user mapping for postgresserver localsrvoptions(user 'postgres', password 'aaBBccDDee22');import foreign schema bookingslimit to (flights, ticket_flights, tickets, aircrafts, airports)from server localsrvinto bookings;insert into dwh.bookings.dim_calendar 	select 		to_char(new_date, 'YYYYMMDD')::int as date_id				, new_date as src_date		, new_date::text as ansi_date		, date_part('DAY', new_date) as day_no		, date_part('WEEK', new_date) as week_no		, date_part('MONTH', new_date) as month_no		, date_part('YEAR', new_date) as year_no		, date_part('DOW', new_date) as weekday	from (select distinct				actual_departure::date as new_date			from				bookings.flights f			where 				f.status='Arrived'			union 			select distinct				actual_arrival::date			from				bookings.flights f			where 				f.status='Arrived'	) as tmp	order by new_date;/* New table dim_passenger */CREATE TABLE dwh.bookings.dim_passenger(  passgr_id serial NOT NULL,  passenger_id varchar(20),  passenger_name text,  contact_data varchar);ALTER TABLE dwh.bookings.dim_passenger ADD CONSTRAINT pk_dim_passenger  PRIMARY KEY (passgr_id);/* New table dim_aircraft */CREATE TABLE dwh.bookings.dim_aircraft(  aircraft_id serial NOT NULL,  aircraft_code char(3),  model text,  range integer);ALTER TABLE dwh.bookings.dim_aircraft ADD CONSTRAINT pk_dim_aircraft  PRIMARY KEY (aircraft_id);/* New table dim_airports */CREATE TABLE dwh.bookings.dim_airports(  airport_id serial NOT NULL,  airport_code char(3),  airport_name text,  city text);ALTER TABLE dwh.bookings.dim_airports ADD CONSTRAINT pk_dim_airports  PRIMARY KEY (airport_id);/* New table dim_tariff */CREATE TABLE dwh.bookings.dim_tariff(  tariff_id serial NOT NULL,  fare_conditions varchar(10));ALTER TABLE dwh.bookings.dim_tariff ADD CONSTRAINT pk_dim_tariff  PRIMARY KEY (tariff_id);/* New table fact_fligts */CREATE TABLE dwh.bookings.fact_fligts(  id serial NOT NULL,  passenger integer,  actual_departure timestamp with time zone,  actual_arrival timestamp with time zone,  departure_delay bigint,  arrival_delay bigint,  aircraft integer,  departure_airport integer,  arrival_airport integer,  tariff integer,  amount numeric(10,2),  departure_dt integer,  arrival_dt integer,  flight_id integer);ALTER TABLE dwh.bookings.fact_fligts ADD CONSTRAINT pk_fact_fligts  PRIMARY KEY (id);ALTER TABLE dwh.bookings.fact_fligts ADD CONSTRAINT fk_fact_fligts_tariff  FOREIGN KEY (tariff) REFERENCES dim_tariff (tariff_id);ALTER TABLE dwh.bookings.fact_fligts ADD CONSTRAINT fk_fact_fligts_departure_airport  FOREIGN KEY (departure_airport) REFERENCES dim_airports (airport_id);ALTER TABLE dwh.bookings.fact_fligts ADD CONSTRAINT fk_fact_fligts_arrival_airport  FOREIGN KEY (arrival_airport) REFERENCES dim_airports (airport_id);ALTER TABLE dwh.bookings.fact_fligts ADD CONSTRAINT fk_fact_fligts_passenger  FOREIGN KEY (passenger) REFERENCES dim_passenger (passgr_id);ALTER TABLE dwh.bookings.fact_fligts ADD CONSTRAINT fk_fact_fligts_aircraft  FOREIGN KEY (aircraft) REFERENCES dim_aircraft (aircraft_id); ALTER TABLE dwh.bookings.fact_fligts ADD CONSTRAINT fk_fact_fligts_departure_dt  FOREIGN KEY (departure_dt) REFERENCES dim_calendar (date_id);ALTER TABLE dwh.bookings.fact_fligts ADD CONSTRAINT fk_fact_fligts_arrival_dt  FOREIGN KEY (arrival_dt) REFERENCES dim_calendar (date_id);/*New table rejected_passengers */CREATE TABLE dwh.bookings.rejected_passengers(  passenger_id varchar(20) NOT NULL,  passenger_name text,  contact_data varchar,  err text,  create_ts timestamp DEFAULT CURRENT_TIMESTAMP);/*New table rejected_aircraft */CREATE TABLE dwh.bookings.rejected_aircraft(  aircraft_code char(3),  model text,  range integer,  err text,  create_ts timestamp DEFAULT CURRENT_TIMESTAMP);/* New table rejected_tariff */CREATE TABLE dwh.bookings.rejected_tariff(  fare_condition varchar(10),  err text,  create_ts timestamp DEFAULT CURRENT_TIMESTAMP);/* New table rejected_airports */CREATE TABLE dwh.bookings.rejected_airports(  airport_code char(3),  airport_name text,  city text,  err text,  create_ts timestamp DEFAULT CURRENT_TIMESTAMP);/* New table rejected_ffact_lights */CREATE TABLE dwh.bookings.rejected_fact_flights(  passenger varchar(20),  actual_departure timestamp with time zone,  actual_arrival timestamp with time zone,  aircraft_code char(3),  departure_airport char(3),  arrival_airport char(3),  fare_conditions varchar(10),  amount numeric(10,2),  flight_id integer,  err text,  create_ts timestamp DEFAULT CURRENT_TIMESTAMP);